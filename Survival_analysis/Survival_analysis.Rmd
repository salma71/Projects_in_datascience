---
title: "Survival analysis"
author: "Salma Elshahawy"
date: "3/26/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Randomised trial of two treatment regimens for lung cancer. This is a standard survival analysis data set.
library(survival)
library(survminer)
library(tidyverse)
library(ggplot2)
library(plyr)
```

```{r}
str(veteran)
```

```{r}
# Dichotomize age and change data labels
veteran$prior <- factor(veteran$prior) %>%
  revalue(c("0"= "No", "10"="Yes"))
```

```{r}
hist(veteran$karno)
veteran$karno <- factor(veteran$karno)
levels(veteran$karno)
```

```{r}
veteran$karno <- factor(veteran$karno) %>%
  revalue(c("0"= "No", "10"="Yes"))
```

```{r}
veteran <- veteran %>% 
  mutate(age_gp = ifelse(age >= 50, "old", "young"))
veteran$age_gp <- factor(veteran$age_gp)

levels(veteran$age_gp)
```

We need to compare `celltype` change during time
```{r}
hist(veteran$age) # bimodal

```
```{r}
surv_object <- Surv(time = veteran$time, event = veteran$status)
surv_object 
```



```{r}
# Fit survival data using the Kaplan-Meier method
fit1 <- survfit(surv_object ~ celltype, data = veteran) 
summary(fit1)
```

You can examine the corresponding survival curve by passing the survival object to the ggsurvplot function. The pval = TRUE argument is very useful, because it plots the p-value of a log rank test as well!

```{r}
ggsurvplot(fit1, pval = TRUE, data = veteran)

```



```{r}
fit2 <- survfit(surv_object ~ karno, data = veteran)
ggsurvplot(fit2, data = veteran, pval = TRUE)
```

```{r}
# Fit a Cox proportional hazards model
fit.coxph <- coxph(surv_object ~ celltype + karno + age, 
                   data = veteran)
ggforest(fit.coxph, data = veteran)
```









